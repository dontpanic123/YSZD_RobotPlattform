# 路线录制功能说明

## 功能概述

新增的路线录制功能允许用户录制机器人的运动路径，并在需要时重播这些路径。这个功能特别适用于：

- 录制复杂的运动序列
- 创建可重复的路径
- 测试和调试机器人行为
- 自动化任务执行

## 主要功能

### 1. 机器人控制
- **键盘控制**: 使用WASD+QE键控制机器人移动
  - W: 前进
  - S: 后退
  - A: 左移
  - D: 右移
  - Q: 左转
  - E: 右转
  - X: 停止

- **按钮控制**: 点击界面上的控制按钮
- **速度调节**: 可调节最大前进/后退、侧向移动和旋转速度

### 2. 路线录制
- **开始录制**: 点击"开始录制"按钮开始录制机器人运动
- **暂停录制**: 点击"暂停录制"按钮暂停/恢复录制
- **停止录制**: 点击"停止录制"按钮停止录制并保存数据

### 3. 路径管理
- **路径命名**: 为录制的路径设置名称
- **保存路径**: 将录制的路径保存到指定目录
- **加载路径**: 加载已保存的路径
- **删除路径**: 删除不需要的路径

### 4. 路径重播
- **开始重播**: 重播已录制的路径
- **暂停重播**: 暂停/恢复重播
- **停止重播**: 停止重播

### 5. 录制信息显示
- 当前路径名称
- 录制时长
- 录制数据大小
- 录制的话题数量
- 实时录制日志

## 使用方法

### 1. 启动系统
```bash
# 启动测试服务器
cd /home/bd/Documents/Robot/agv_sim/web
./start_route_recording_test.sh
```

### 2. 访问界面
- 主页面: http://localhost:8080/index.html
- 测试页面: http://localhost:8080/test_route_recording.html

### 3. 录制路径
1. 切换到"路线录制"tab
2. 输入路径名称
3. 设置保存路径（可选）
4. 点击"开始录制"
5. 使用键盘或按钮控制机器人移动
6. 点击"停止录制"完成录制

### 4. 重播路径
1. 在路径列表中选择要重播的路径
2. 点击"开始重播"
3. 机器人将按照录制的路径移动

## 技术实现

### 前端架构
- **HTML**: 使用tab结构组织界面
- **CSS**: 响应式设计，支持移动端
- **JavaScript**: 模块化设计，易于扩展

### 数据存储
- 使用localStorage保存路径数据
- 支持路径的增删改查操作
- 自动备份和恢复功能

### ROS2集成
- 订阅机器人控制话题 (`/cmd_vel`)
- 录制里程计数据 (`/odom`)
- 录制摄像头数据 (`/camera/image_raw`)
- 支持自定义话题录制

## 文件结构

```
web/
├── index.html                    # 主页面（已更新）
├── test_route_recording.html     # 测试页面
├── css/
│   └── style.css                # 样式文件（已更新）
├── js/
│   ├── route-recording.js       # 路线录制模块（新增）
│   ├── robot-control.js         # 机器人控制模块
│   ├── ros2-bridge.js          # ROS2桥接模块
│   └── main.js                  # 主应用模块
├── start_route_recording_test.sh # 测试启动脚本
└── ROUTE_RECORDING_README.md    # 功能说明文档
```

## 配置选项

### 录制话题配置
```javascript
this.recordingTopics = ['/cmd_vel', '/odom', '/camera/image_raw'];
```

### 保存路径配置
默认保存路径: `/home/bd/Documents/Robot/agv_sim/rosbags`

### 重播频率配置
```javascript
setInterval(() => {
    // 重播逻辑
}, 100); // 10Hz重播频率
```

## 故障排除

### 常见问题

1. **录制按钮无响应**
   - 检查ROS2连接状态
   - 确认路径名称已输入
   - 查看浏览器控制台错误信息

2. **重播不工作**
   - 确认有已保存的路径
   - 检查路径数据完整性
   - 验证ROS2话题连接

3. **路径保存失败**
   - 检查保存路径权限
   - 确认磁盘空间充足
   - 查看浏览器存储限制

### 调试方法

1. **查看控制台日志**
   ```javascript
   console.log('录制状态:', this.isRecording);
   console.log('录制数据:', this.recordingData);
   ```

2. **检查本地存储**
   ```javascript
   console.log('保存的路径:', localStorage.getItem('recordedPaths'));
   ```

3. **验证ROS2连接**
   ```javascript
   console.log('ROS2连接状态:', window.ros2Bridge.isConnected());
   ```

## 扩展功能

### 计划中的功能
- [ ] 路径可视化显示
- [ ] 路径编辑功能
- [ ] 多路径组合
- [ ] 路径优化算法
- [ ] 云端路径同步

### 自定义扩展
- 添加新的录制话题
- 自定义重播速度
- 路径数据导出/导入
- 与其他系统集成

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交更改
4. 创建Pull Request

## 许可证

本项目采用MIT许可证。详情请查看LICENSE文件。
